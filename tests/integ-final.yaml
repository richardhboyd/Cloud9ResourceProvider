AWSTemplateFormatVersion: 2010-09-09
Resources:
  MyC9Environment03:
    Type: Richard::Cloud9::Environment
    Properties:
      InstanceType: c5.large
      EBSVolumeSize: 50
      OwnerArn: "arn:aws:sts::908752905784:assumed-role/CrossAccountRole-RootRole-1AYURKOCV4R8Y/rhboyd-Isengard"
      UserData: 
        Fn::Base64: |
          sudo echo "ec2-user ALL=(root:root) NOPASSWD:ALL" > /etc/sudoers.d/custom
          sudo -u root -s
          cd /
          VERSION=3.7.4
          yum update -y
          yum install gcc openssl-devel bzip2-devel libffi-devel -y
          wget https://www.python.org/ftp/python/${VERSION}/Python-${VERSION}.tgz
          tar xzf Python-${VERSION}.tgz
          cd Python-${VERSION}
          ./configure --enable-optimizations
          make altinstall
          cd ../
          # Remove old symlinks
          rm -rf /etc/alternatives/pip
          rm -rf /etc/alternatives/python
          # make new symlinks
          ln -s /usr/local/bin/pip${VERSION:0:3} /etc/alternatives/pip
          ln -s /usr/local/bin/python${VERSION:0:3} /etc/alternatives/python
          exit
          cd /home/ec2-user/
          su -u ec2-user
          CI=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
          test -d ~/.linuxbrew && eval $(~/.linuxbrew/bin/brew shellenv)
          test -d /home/linuxbrew/.linuxbrew && eval $(/home/linuxbrew/.linuxbrew/bin/brew shellenv)
          test -r ~/.bash_profile && echo "eval \$($(brew --prefix)/bin/brew shellenv)" >>~/.bash_profile
          echo "eval \$($(/home/linuxbrew/.linuxbrew/bin/brew --prefix)/bin/brew shellenv)" >>~/.profile
          npm uninstall -g aws-sam-local
          sudo pip uninstall aws-sam-cli
          sudo rm -rf $(which sam)
          brew tap aws/tap
          brew install aws-sam-cli
          /home/linuxbrew/.linuxbrew/bin/sam
          ln -sf $(which sam) ~/.c9/bin/sam
          exit